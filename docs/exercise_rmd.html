<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Exercise</title>

<script src="site_libs/header-attrs-2.5/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Workshop Notes</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="practical_session_1.html">Practical session 1</a>
</li>
<li>
  <a href="practical_session_2.html">Practical session 2</a>
</li>
<li>
  <a href="exercise_rmd.html">Exercise</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Exercise</h1>

</div>


<p>Starting from the raw fishing data of 5 vessels operating in GSA 23 apply the R4ais workflow to obtain fishing segments, and then analyse the data to obtain a map of the fishing effort. The exercise is divided into 4 questions which helps you to get the desired result. All the code you need is part of the script seen today.</p>
<div id="before-to-start" class="section level1">
<h1>Before to start</h1>
<p>You need to check your working directory (WD), which has to be “dwrs_workshop_2022”. The <code>getwd()</code> command shows you where the WD is. The <code>setwd('..')</code> command set the WD to a backward place.</p>
<div id="load-sample-data" class="section level3">
<h3>Load sample data</h3>
<p>Data needed for the exercise are the sample fishing points</p>
<pre class="r"><code>sample_data=readRDS(&quot;practical_session_2/data/exercise_data.rData&quot;)</code></pre>
<table class=" lightable-paper lightable-hover" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
MMSI
</th>
<th style="text-align:left;">
datetime
</th>
<th style="text-align:right;">
longitude
</th>
<th style="text-align:right;">
latitude
</th>
<th style="text-align:right;">
speed
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1.1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2018-12-04 02:55:13
</td>
<td style="text-align:right;">
25.0754
</td>
<td style="text-align:right;">
35.3787
</td>
<td style="text-align:right;">
4.1
</td>
</tr>
<tr>
<td style="text-align:left;">
1.2
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2018-12-04 03:43:33
</td>
<td style="text-align:right;">
25.0739
</td>
<td style="text-align:right;">
35.4097
</td>
<td style="text-align:right;">
7.3
</td>
</tr>
<tr>
<td style="text-align:left;">
1.3
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2018-12-04 03:49:35
</td>
<td style="text-align:right;">
25.0645
</td>
<td style="text-align:right;">
35.4194
</td>
<td style="text-align:right;">
8.6
</td>
</tr>
<tr>
<td style="text-align:left;">
1.4
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2018-12-04 04:26:50
</td>
<td style="text-align:right;">
25.0041
</td>
<td style="text-align:right;">
35.4639
</td>
<td style="text-align:right;">
8.9
</td>
</tr>
<tr>
<td style="text-align:left;">
1.5
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2018-12-04 04:43:57
</td>
<td style="text-align:right;">
25.0306
</td>
<td style="text-align:right;">
35.4607
</td>
<td style="text-align:right;">
2.7
</td>
</tr>
<tr>
<td style="text-align:left;">
1.6
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2018-12-04 06:02:31
</td>
<td style="text-align:right;">
25.1061
</td>
<td style="text-align:right;">
35.4426
</td>
<td style="text-align:right;">
3.3
</td>
</tr>
</tbody>
</table>
<pre><code>## Coordinate system already present. Adding new coordinate system, which will replace the existing one.</code></pre>
<p><img src="exercise_rmd_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="load-r4ais-functions" class="section level3">
<h3>Load R4ais functions</h3>
<p>In addition you need to load the functions contained in the R4ais release. You need just to run the following lines</p>
<pre class="r"><code>base_dir=getwd()
setwd(&#39;practical_session_1&#39;)
dirmaps=&quot;AIS_data_processing/maps&quot; # path of the maps directory
file_parameters=&quot;AIS_data_processing/data/parameters.csv&quot; # import parameter table
file_centroids=&quot;AIS_data_processing/data/centroids.csv&quot; # import centroids 
wgs=&quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&quot; # Insert your coordinates system
install.missing.packages=T # set to TRUE if want to allow automatic installation of missing packages.
source(&quot;AIS_data_processing/R/global_functions.R&quot;) # load all internal function required
ports&lt;-read_sf(file.path(dirmaps, &quot;med_harb_gsa&quot;)) # import list of ports
port_buf&lt;-st_buffer(ports, 0.001) # create a buffer
st_crs(port_buf)=wgs # set crs
coastal_ban_zone=read_sf(file.path(dirmaps, &quot;coastal_ban_zone&quot;)) # import managment depth layer
st_crs(coastal_ban_zone)=wgs # set crs
grid&lt;-read_sf(file.path(dirmaps, &quot;grid01degrees&quot;)) # import a grid
grid$grid_id=seq(1:nrow(grid)) # create cell grid id
st_crs(grid)=wgs # set crs
centroids=inport_parameters(file.path(file_parameters), file.path(file_centroids))[[2]]
pars=inport_parameters(file.path(file_parameters), file.path(file_centroids))[[1]]
setwd(base_dir)</code></pre>
<p><br></p>
</div>
</div>
<div id="questions" class="section level1">
<h1>Questions</h1>
<div id="q1" class="section level3">
<h3>Q1</h3>
<p>Obtain the fishing segments from one single vessel (data provided): you need to identify the right function from the workflow. Tip: the output of the function is a list, so you need to process the output as x=plyr::ldply(x)</p>
<p>As input data you can use sample_dat_Q1, produced as:</p>
<pre class="r"><code>sample_dat_Q1=sample_data[sample_data$MMSI==unique(sample_data$MMSI)[1],]</code></pre>
</div>
<div id="q2" class="section level3">
<h3>Q2</h3>
<p>Extract fishing segments from all the vessels in the sample data at once: you need to identify the right function from the workflow. The resulting object must be called <code>all_fishing_tracks</code> Tip: after having applied the right function, you need to pass the output to the following lines</p>
<pre class="r"><code># post process 1
for(i in 1:length(all_fishing_tracks)){
all_fishing_tracks[[i]]=plyr::ldply(all_fishing_tracks[[i]])
}
# post process 2
all_fishing_tracks=plyr::ldply(all_fishing_tracks)</code></pre>
</div>
<div id="q3" class="section level3">
<h3>Q3</h3>
<p>Intersect the obtained data with the grid of GSA 23. Tip: the piece of code you need is a for loop.</p>
<p>Before to start, run the following lines to import the correct function and parameters (attention: this is an extra tip).</p>
<pre class="r"><code>source(&quot;practical_session_2/R/supporting_code/global_functions_light.R&quot;)
grid=read_sf(&quot;practical_session_2/maps/grid&quot;)
activate_filter=&#39;Y&#39;
ref_years=2015:2018</code></pre>
</div>
<div id="q4" class="section level3">
<h3>Q4</h3>
<p>Create a map of the fishing effort. Tip: the following lines import all the shapefiles and the plot specifications.</p>
<pre class="r"><code>grid_whole &lt;- read_sf(&quot;practical_session_2/maps/grid&quot;)

land=read_sf(&quot;practical_session_2/maps/land&quot;)%&gt;% 
  st_crop(., xmin=-10, xmax=43, ymin=20, ymax=48) #

gsa&lt;-read_sf(&quot;practical_session_2/maps/gsa&quot;)%&gt;%
  dplyr::filter(SMU_CODE == &#39;23&#39; )

dep = read_sf(&quot;practical_session_2/maps/depth_contours&quot;)%&gt;%
  st_cast(., to = &quot;POLYGON&quot;)%&gt;%
  st_set_crs(st_crs(gsa))%&gt;%
  st_buffer(0)%&gt;%
  st_crop(gsa)

lims=c(st_bbox(gsa[c(1,3)], st_bbox(gsa[c(2,4)])))

#### Specifications for the plot ####
# Plot size
text_size=8
plot_height=25
plot_width=18
library(ggspatial)
library(ggnewscale)
source(&quot;practical_session_2/R/supporting_code/plot_specifications.R&quot;)</code></pre>
</div>
<div id="q-5" class="section level3">
<h3>Q 5</h3>
<p>Looking at the fishing track data you may notice that there is poor information regarding the fishing trips and the fishing vessels, so our possibility of data exploration are limited.</p>
<p><br></p>
<p>Here you are provided with the tools to get a bite of information on the destination of the fishing trip and on the origin of the fishing vessel. Having this additional information at hand, you may create your own thematic map focusing on an aspect of your choice (for example effort by country, effort by port of destination etc..).</p>
<p><br> Here are provided some tips to make the job easier</p>
<p><br></p>
<ul>
<li>Tip 1: By applying the correct function (within those seen this morning) it is possible to get information on the harbour of arrival of each trip. Then, this information can be linked to the tracks.</li>
</ul>
<pre class="r"><code>vessels=unique(sample_data$MMSI)
all_fishing_trips=list()
for(i in 1:length(vessels)){
  cat(&quot;\n&quot;, &quot;vessel&quot;, i, &quot;of&quot;, length(vessels))
  cat(&quot;\n&quot;)
  xvessel=sample_data[which(sample_data$MMSI == vessels[i]),]
  dat_trip=create_fishing_trip(data=xvessel,
                               ports=ports, 
                               ports_buffer=port_buf,
                               coastal_ban_zone=coastal_ban_zone)
  all_fishing_trips[[i]]=dat_trip
}
all_fishing_trips=plyr::ldply(all_fishing_trips)</code></pre>
<p><br></p>
<ul>
<li><p>Tip 2: the information of the ports is contained in the object ‘ports’, you need to paste it to the fishing data.</p></li>
<li><p>Tip 3: Nationality of the sample vessels: detailed vessel information is not provided for privacy reasons, however here we give the nationality of registration for the sample data.</p></li>
</ul>
<pre class="r"><code>vessel_country=data.frame(MMSI=as.character(2:9),
           country=c(rep(&#39;GRC&#39;,6), rep(&#39;ITA&#39;,2)),
           GSA_registration=c(rep(&#39;GSA23&#39;,6), rep(&#39;GSA16&#39;,2)))</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
